{%- assign page_blacklist = 'index.html,index.md,README.md' | split: ',' -%}
{%- assign section_dir = 'Recipes' -%}

{%- if include.list_style == 'list' %}
  {%- assign list_class = 'recipe-list' -%}
{%- else -%}
  {%- assign list_class = 'recipe-cards' -%}
{%- endif -%}

<ul class="{{list_class}}">
{% assign sortedPages = site.pages | sort: 'title' -%}
{%- for sitePage in sortedPages | sort: 'title' -%}

  {%- assign segments = sitePage.dir | remove_first: '/' | split: '/' -%}
  {%- assign section = segments | first -%}

  {%comment%} Make sure we don't include this current page in the list of pages being displayed. {%endcomment%}
  {%- if page.path == sitePage.path %}
    {%- continue -%}
  {%- endif -%}

  {%- if section != section_dir %}
    {%- continue -%}
  {%- endif -%}

  {%- if sitePage.index == 'hidden' and include.show_hidden != 'True' -%}
    {%- continue -%}
  {%- endif -%}

  {%- if page_blacklist contains sitePage.name -%}
    {%- continue -%}
  {%- endif -%}

  {%- if include.filter_category -%}
    {%- if sitePage.category contains include.filter_category -%}
    {%- else -%}
      {%- continue -%}
    {%- endif -%}
  {%- endif -%}

  {%- if include.filter_author -%}
    {%- if sitePage.authors contains include.filter_author -%}
    {%- else -%}
      {%- continue -%}
    {%- endif -%}
  {%- endif -%}

  {%- if include.filter_tag -%}
    {%- if sitePage.tags contains include.filter_tag or include.filter_tag == "NONE" and sitePage.tags == nil -%}
    {%- else -%}
      {%- continue -%}
    {%- endif -%}
  {%- endif -%}

  {%- if include.filter_ingredient == nil or sitePage.ingredients contains include.filter_ingredient -%}
  {%- else -%}
    {%- continue -%}
  {%- endif -%}

  {%- if include.filter_favorite == nil or sitePage.favorite contains include.filter_favorite -%}
  {%- else -%}
    {%- continue -%}
  {%- endif -%}

  {%- if sitePage.category -%}
    {%- assign category = sitePage.category -%}
  {%- else -%}
    {%- assign category = 'none' -%}
  {%- endif -%}

  {%- if include.hide_description == nil and sitePage.description != nil and sitePage.description != '' -%}
    {%- assign page_description = ' — ' | append: sitePage.description}} -%}
  {%- else -%}
    {%- assign page_description = '' -%}
  {%- endif -%}

  {%- if sitePage.tags and sitePage.tags.first -%}
    {%- assign tags = sitePage.tags | sort -%}
  {%- else -%}
    {%- assign tags = 'none' -%}
  {%- endif -%}

  {%- if sitePage.authors and sitePage.authors.first -%}
    {%- assign authors = sitePage.authors | push: 'any' | sort -%}
  {%- else -%}
    {%- assign authors = 'none' -%}
  {%- endif -%}

  {%- if sitePage.seasons and sitePage.seasons.first -%}
    {%- assign seasons = sitePage.seasons | push: 'any' | sort -%}
  {%- else -%}
    {%- assign seasons = 'none' -%}
  {%- endif -%}

  {%- if sitePage.favorite and sitePage.favorite.first -%}
    {%- assign favorite = sitePage.favorite | push: 'any' | sort -%}
  {%- else -%}
    {%- assign favorite = 'none' -%}
  {%- endif -%}

  {%- if sitePage.ingredients and sitePage.ingredients.first -%}
    {%- assign ingredients = sitePage.ingredients | sort -%}
  {%- else -%}
    {%- assign ingredients = 'none' -%}
  {%- endif -%}

  {%- if include.list_style == 'list' -%}
    {%- assign recipe_style = '' -%}
  {%- elsif sitePage.hero_image -%}
    {%- assign recipe_image_url = '/images/' | append: sitePage.hero_image | relative_url -%}
    {%- assign recipe_style = 'style="background-size: cover; background-image: url(' | append: recipe_image_url | append: ')"' -%}
  {%- elsif sitePage.tags contains 'cocktails' -%}
    {%- assign recipe_image_url = '/images/cocktail_experiment.jpg' | relative_url -%}
    {%- assign recipe_style = 'style="background-size: cover; background-image: url(' | append: recipe_image_url | append: ')"' -%}
  {%- else -%}
    {%- assign recipe_style = '' -%}
  {%- endif -%}
  <li class="recipe-link category-{{ category }} tag-{{ tags | join: ' tag-' }} author-{{ authors | join: ' author-' }} season-{{ seasons | join: ' season-' }} favorite-{{ favorite | join: ' favorite-' }} ingredient-{{ ingredients | join: ' ingredient-' }}" {{ recipe_style }}>
    <a href="{{ sitePage.url | relative_url }}">
    {%- if include.list_style == 'list' -%}
        {{sitePage.title}}
    {%- else -%}
      <span class="text">
        <strong>{{sitePage.title}}</strong>
      {%- if include.hide_description != nil or sitePage.description != nil or sitePage.description != '' -%}
        {{ sitePage.description }}
        {%- else -%}
        <ul class="tags">
          {% for tag in tags %}
          <li>{{tag}}</li>
          {% endfor -%}
        </ul>
        <ul class="key-ingredients">
          {% for ingredient in ingredients %}
          <li>{{ingredient}}</li>
          {% endfor -%}
        </ul>
        {%- endif -%}
      </span>

      {% if sitePage.favorite and sitePage.favorite.first -%}
      <span class="favorite-icons">
        {% assign favorites_sorted = sitePage.favorite | sort %}
        {% for favorite in favorites_sorted -%}
          <span class="{{favorite}}">★</span>
        {% endfor -%}
      </span>
      {% endif -%}
    {%- endif -%}
    </a>

    {%- if include.list_style == 'list' and sitePage.description -%}
      {%- if include.hide_description != nil or sitePage.description != nil or sitePage.description != '' %}
        — {{ sitePage.description }}
      {%- endif -%}
    {%- endif -%}
  </li>
{%- endfor %}
</ul>
